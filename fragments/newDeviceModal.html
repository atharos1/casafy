<div class="modal fade" id="newDeviceModal" tabindex="-1" role="dialog" aria-labelledby="createDeviceTitle"
							aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="createDeviceTitle">Crear dispositivo</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form>
					<div class="form-group row" style="padding-bottom: 10px">
						<div class="col-md-4">Tipo:</div>
						<div class="col-md-6">
							<div class="dropdown" id="deviceTypeBtn">
								<button class="btn btn-secondary dropdown-toggle" type="button"
									id="dropdownDeviceBtn" data-toggle="dropdown" aria-haspopup="true"
									aria-expanded="false">
									Seleccionar...
								</button>
								<div class="dropdown-menu" aria-labelledby="dropdownMenuButton"
									id="deviceOptions">
								</div>
							</div>
						</div>
					</div>
					<div class="form-group row" style="padding-bottom: 10px">
						<div class="col-md-4">Nombre:</div>
						<div class="col-md-2">
							<input id="deviceName" type="text" name="devicename" size=25 maxlength=25><br>
						</div>
					</div>
					<div class="form-group" style="padding-bottom: 10px">
						<label for="description">Descripci√≥n</label>
						<textarea class="form-control" id="deviceDescription" rows="3"></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
				<button type="button" class="btn btn-primary" id = "createDeviceBtn">Crear</button>
			</div>
		</div>
	</div>
</div>

<script>
	$('#newDeviceModal').on('show.bs.modal', function (event) {
			if ($('#deviceOptions').children().length == 0) {
				api.get(api.baseUrl + "devicetypes")
					.then(data => {
						var deviceTypes = data["devices"];
						for (typeNum in deviceTypes) {
							$('#deviceOptions').append("<button class=\"dropdown-item\" type=\"button\" onClick=\"copyText(dropdownDeviceBtn,this)\" id=\"" +
								deviceTypes[typeNum]["id"] + "\">" + deviceTypes[typeNum]["name"] + "</button>");
						}
					})
					.catch(error => {
						alert("Request failed: " + error);
					});
			}
			api.rooms.getAll()
				.then(data => {
					var menu = $("#roomOptions");
					var rooms = data["rooms"];
					var added = false;
					for(roomNum in rooms){
						added = false;
						menu.children(".dropdown-item").each(function(i) {
							if($(this).text().toLowerCase() === rooms[roomNum]["name"].toLowerCase())
								added = true;
						});
						if(!added)
							menu.append("<button class=\"dropdown-item\" type=\"button\" onClick=\"copyText(dropdownRoomBtn,this)\">" + rooms[roomNum]["name"] + "</button>");
					}
				}).catch(error => {
					alert("Request failed: " + error);
				});
	});

	$('#createDeviceBtn').on('click', function(event) {
		var type = $('dropdownDeviceBtn').text();
		var typeId = "";
		$('#deviceOptions').children(".dropdown-item").each(function(i) {
			if($(this).text().toLowerCase() === type)
				typeId = $(this).attr("id");
		});
		var name = $('#deviceName').val();
		var desc = $('#deviceDescription').val();
		var newDevice = {
			name: name,
			typeId: "go46xmbqeomjrsjr",
			meta: "{\"desc\":\"" + desc + "\"}"
		};

		api.devices
		.create(newDevice)
		.then(data => {
			//TODO: Agregar dispositivo a la habitacion
			location.reload();
		})
		.catch(error => {
			alert("Request failed: " + error);
		});

		//reload
	});
</script>
